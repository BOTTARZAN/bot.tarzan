<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🔥 لوحة تحكم الجلسات - طرزان الواقدي</title>
<style>
    body {
        font-family: 'Cairo', sans-serif;
        background: #0f172a;
        color: #fff;
        margin: 0;
        padding: 0;
        text-align: center;
        direction: rtl;
    }

    header {
        background: #1e293b;
        padding: 20px;
        font-size: 24px;
        color: #00f7ff;
        font-weight: bold;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
    }

    main {
        padding: 20px;
    }

    input {
        padding: 10px;
        margin: 8px;
        border-radius: 8px;
        border: none;
        font-size: 16px;
        width: 250px;
    }

    button {
        padding: 10px 15px;
        background: #00f7ff;
        color: #101820;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    button:hover {
        background: #06c2d4;
    }

    .pair-code {
        margin-top: 15px;
        font-size: 18px;
        font-weight: bold;
        color: #00ff95;
    }

    table {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
        background: #1f2937;
        border-radius: 8px;
        overflow: hidden;
    }

    th, td {
        padding: 12px;
        border-bottom: 1px solid #333;
    }

    th {
        background: #00f7ff;
        color: #101820;
    }

    td button {
        padding: 6px 12px;
        font-size: 14px;
    }

    .status-online {
        color: #00ff00;
        font-weight: bold;
    }

    .status-offline {
        color: #ff3c3c;
        font-weight: bold;
    }

    footer {
        margin-top: 20px;
        font-size: 14px;
        color: #999;
    }
</style>
</head>
<body>
<header>🔥 لوحة تحكم الجلسات - طرزان الواقدي</header>

<main>
    <h2>➕ إنشاء جلسة جديدة</h2>
    <input type="text" id="sessionId" placeholder="معرف الجلسة (مثال: session1)">
    <input type="text" id="phoneNumber" placeholder="رقم واتساب مع الكود الدولي">
    <button onclick="createSession()">إنشاء الجلسة</button>
    <div id="pairCode" class="pair-code"></div>

    <h2>📋 الجلسات النشطة</h2>
    <table>
        <thead>
            <tr>
                <th>المعرف</th>
                <th>الحالة</th>
                <th>آخر نشاط</th>
                <th>تحكم</th>
            </tr>
        </thead>
        <tbody id="sessionsTable"></tbody>
    </table>
</main>

<footer>طرزان الواقدي © 2025</footer>

<script>
async function fetchSessions() {
    const res = await fetch('/sessions');
    const sessions = await res.json();
    const tbody = document.getElementById('sessionsTable');
    tbody.innerHTML = '';

    sessions.forEach(session => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${session.id}</td>
            <td class="${session.connected ? 'status-online' : 'status-offline'}">
                ${session.connected ? '✅ متصل' : '❌ غير متصل'}
            </td>
            <td>${session.lastActive}</td>
            <td>
                <button onclick="deleteSession('${session.id}')">🗑 حذف</button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

async function createSession() {
    const sessionId = document.getElementById('sessionId').value.trim();
    const phoneNumber = document.getElementById('phoneNumber').value.trim();
    const pairCodeDiv = document.getElementById('pairCode');

    if (!sessionId || !phoneNumber) {
        alert('❌ أدخل معرف الجلسة ورقم الهاتف');
        return;
    }

    pairCodeDiv.innerHTML = "⏳ جاري إنشاء رمز الاقتران...";
    const res = await fetch('/pair', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ number: phoneNumber, sessionId })
    });

    const data = await res.json();
    if (data.pairingCode) {
        pairCodeDiv.innerHTML = `✅ رمز الاقتران: <span style="color: yellow;">${data.pairingCode}</span>`;
        playSound();
    } else {
        pairCodeDiv.innerHTML = `❌ ${data.error || 'فشل إنشاء الجلسة'}`;
    }

    fetchSessions();
}

async function deleteSession(sessionId) {
    const confirmDelete = confirm('هل تريد حذف هذه الجلسة؟');
    if (!confirmDelete) return;

    alert('🛑 حذف الجلسة غير مدعوم بعد في API، أضفه لاحقًا في السيرفر.');
}

function playSound() {
    const audio = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_86f3996a9a.mp3');
    audio.play();
}

setInterval(fetchSessions, 5000);
fetchSessions();
</script>
</body>
</html>
