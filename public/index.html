<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¬Ù„Ø³Ø§Øª - Ø·Ø±Ø²Ø§Ù† Ø§Ù„ÙˆØ§Ù‚Ø¯ÙŠ</title>
<style>
    body {
        font-family: 'Cairo', sans-serif;
        background: #101820;
        color: #fff;
        margin: 0;
        text-align: center;
        direction: rtl;
    }

    header {
        background: #1f2937;
        padding: 15px;
        font-size: 22px;
        color: #00f7ff;
    }

    main {
        padding: 20px;
    }

    input {
        padding: 10px;
        margin: 8px;
        border-radius: 8px;
        border: none;
        font-size: 16px;
        width: 250px;
    }

    button {
        padding: 10px 15px;
        background: #00f7ff;
        color: #101820;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    button:hover {
        background: #06c2d4;
    }

    table {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
        background: #1f2937;
        border-radius: 8px;
        overflow: hidden;
    }

    th, td {
        padding: 12px;
        border-bottom: 1px solid #333;
    }

    th {
        background: #00f7ff;
        color: #101820;
    }

    td button {
        padding: 6px 12px;
        font-size: 14px;
    }

    .status-online {
        color: #00ff00;
        font-weight: bold;
    }

    .status-offline {
        color: #ff3c3c;
        font-weight: bold;
    }

    .pair-code {
        margin-top: 10px;
        font-size: 18px;
        color: #00f7ff;
        font-weight: bold;
    }
</style>
</head>
<body>
<header>
    <h1>ğŸ”¥ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¬Ù„Ø³Ø§Øª - Ø·Ø±Ø²Ø§Ù† Ø§Ù„ÙˆØ§Ù‚Ø¯ÙŠ</h1>
</header>

<main>
    <section class="add-session">
        <h2>â• Ø¥Ø¶Ø§ÙØ© Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
        <input type="text" id="sessionId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù„Ø³Ø©">
        <input type="text" id="phoneNumber" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„ÙŠ">
        <button onclick="createSession()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
        <div id="pairCode" class="pair-code"></div>
    </section>

    <section class="sessions">
        <h2>ğŸ“‹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ø¹Ø±Ù</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</th>
                    <th>ØªØ­ÙƒÙ…</th>
                </tr>
            </thead>
            <tbody id="sessionsTable"></tbody>
        </table>
    </section>
</main>

<script>
async function fetchSessions() {
    const res = await fetch('/sessions');
    const sessions = await res.json();
    const tbody = document.getElementById('sessionsTable');
    tbody.innerHTML = '';

    sessions.forEach(session => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${session.id}</td>
            <td class="${session.connected ? 'status-online' : 'status-offline'}">
                ${session.connected ? 'âœ… Ù…ØªØµÙ„' : 'âŒ ØºÙŠØ± Ù…ØªØµÙ„'}
            </td>
            <td>${session.lastActive}</td>
            <td>
                <button onclick="deleteSession('${session.id}')">ğŸ—‘ Ø­Ø°Ù</button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

async function createSession() {
    const sessionId = document.getElementById('sessionId').value.trim();
    const phoneNumber = document.getElementById('phoneNumber').value.trim();
    const pairCodeDiv = document.getElementById('pairCode');

    if (!sessionId || !phoneNumber) {
        alert('âŒ Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù„Ø³Ø© ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ');
        return;
    }

    pairCodeDiv.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ù…Ø²...";
    const res = await fetch('/pair', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ number: phoneNumber, sessionId })
    });

    const data = await res.json();
    if (data.pairingCode) {
        pairCodeDiv.innerHTML = `âœ… Ø±Ù…Ø² Ø§Ù„Ø§Ù‚ØªØ±Ø§Ù†: <span style="color: yellow;">${data.pairingCode}</span>`;
        playSound();
    } else {
        pairCodeDiv.innerHTML = 'âŒ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©';
    }

    fetchSessions();
}

async function deleteSession(sessionId) {
    const password = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø©');
    const res = await fetch('/delete-session', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password, sessionId })
    });
    const data = await res.json();
    alert(data.message || data.error);
    fetchSessions();
}

function playSound() {
    const audio = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_86f3996a9a.mp3');
    audio.play();
}

setInterval(fetchSessions, 5000);
fetchSessions();
</script>
</body>
</html>
